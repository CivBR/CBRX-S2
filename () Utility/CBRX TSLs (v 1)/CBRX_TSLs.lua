local cbrxTSLs = {}

cbrxTSLs["CIVILIZATION_BABYLON"] = {X=46, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_SENSHI_CHUKCHI"] = {X=61, Y=60, S="F", O="T"}
cbrxTSLs["CIVILIZATION_THP_ALEUT"] = {X=64, Y=54, S="T", O="T"}
cbrxTSLs["CIVILIZATION_GR_OSAGE"] = {X=80, Y=44, S="F", O="F"}
cbrxTSLs["CIVILIZATION_CHEROKEE_LS_MOD"] = {X=80, Y=44, S="F", O="F"}
cbrxTSLs["CIVILIZATION_S_POWHATAN"] = {X=87, Y=44, S="F", O="F"}
cbrxTSLs["CIVILIZATION_DMS_ANGOLA"] = {X=16, Y=12, S="F", O="F"}
cbrxTSLs["CIVILIZATION_DOGGO_SHILLUK"] = {X=21, Y=21, S="F", O="F"}
cbrxTSLs["CIVILIZATION_SENSHI_ZANZIBAR"] = {X=22, Y=15, S="F", O="F"}
cbrxTSLs["CIVILIZATION_SENSHI_MARAJO"] = {X=92, Y=25, S="F", O="F"}
cbrxTSLs["CIVILIZATION_THP_CHEYENNE"] = {X=77, Y=51, S="F", O="F"}
cbrxTSLs["CIVILIZATION_DENEFIRSTNATION"] = {X=75, Y=57, S="F", O="F"}
cbrxTSLs["CIVILIZATION_RTOLTEC"] = {X=77, Y=35, S="F", O="F"}
cbrxTSLs["CIVILIZATION_MC_MAORI"] = {X=67, Y=8, S="T", O="T"}
cbrxTSLs["CIVILIZATION_CL_KULIN"] = {X=62, Y=6, S="F", O="F"}
cbrxTSLs["CIVILIZATION_THP_ANANGU"] = {X=56, Y=11, S="F", O="F"}
cbrxTSLs["CIVILIZATION_CLKIMBERLEY"] = {X=53, Y=14, S="F", O="F"}
cbrxTSLs["CIVILIZATION_THP_CHAMORRO"] = {X=61, Y=33, S="T", O="T"}
cbrxTSLs["CIVILIZATION_VIVALA_PALAU"] = {X=60, Y=27, S="T", O="T"}
cbrxTSLs["CIVILIZATION_JFD_HAWAII"] = {X=67, Y=39, S="T", O="T"}
cbrxTSLs["CIVILIZATION_VIVALA_FYROM"] = {X=17, Y=38, S="F", O="F"}
cbrxTSLs["CIVILIZATION_YAKUTIA"] = {X=49, Y=55, S="F", O="F"}
cbrxTSLs["CIVILIZATION_VIVALA_MONGOLIA"] = {X=45, Y=50, S="F", O="F"}
cbrxTSLs["CIVILIZATION_EW_KYRGYZ"] = {X=39, Y=54, S="F", O="F"}
cbrxTSLs["CIVILIZATION_CB_AGUINALDOPH"] = {X=53, Y=32, S="T", O="F"}
cbrxTSLs["CIVILIZATION_VIETNAM_LS_MOD"] = {X=46, Y=32, S="F", O="F"}
cbrxTSLs["CIVILIZATION_THP_PALA"] = {X=41, Y=33, S="F", O="F"}
cbrxTSLs["CIVILIZATION_TAIRONA"] = {X=87, Y=28, S="F", O="F"}
cbrxTSLs["CIVILIZATION_MUISCA"] = {X=87, Y=27, S="F", O="F"}
cbrxTSLs["CIVILIZATION_JAR_KALBIDS"] = {X=12, Y=33, S="T", O="F"}
cbrxTSLs["CIVILIZATION_TCM_SICILY"] = {X=12, Y=33, S="T", O="F"}
cbrxTSLs["CIVILIZATION_TCM_THE_IBERIANS"] = {X=6, Y=36, S="F", O="F"}
cbrxTSLs["CIVILIZATION_TCM_HYKSOS"] = {X=20, Y=29, S="F", O="F"}
cbrxTSLs["CIVILIZATION_TCM_BACTRIA"] = {X=33, Y=37, S="F", O="F"}
cbrxTSLs["CIVILIZATION_DAHOMEY_TS"] = {X=11, Y=20, S="F", O="F"}
cbrxTSLs["CIVILIZATION_PB_LIBERTATIA"] = {X=27, Y=11, S="T", O="F"}
cbrxTSLs["CIVILIZATION_ORG_MALACCA"] = {X=46, Y=23, S="T", O="F"}
cbrxTSLs["CIVILIZATION_CHAMPA_MOD"] = {X=49, Y=29, S="F", O="F"}
cbrxTSLs["CIVILIZATION_VANA_VOC"] = {X=49, Y=17, S="T", O="T"}
cbrxTSLs["CIVILIZATION_MC_CHOLA"] = {X=38, Y=23, S="F", O="F"}
cbrxTSLs["CIVILIZATION_QULLANA"] = {X=86, Y=18, S="F", O="F"}
cbrxTSLs["CIVILIZATION_REPARAGUAY"] = {X=92, Y=16, S="F", O="F"}
cbrxTSLs["CIVILIZATION_MAPUCHE_LS_MOD"] = {X=88, Y=11, S="F", O="F"}
cbrxTSLs["CIVILIZATION_MC_TUAREG"] = {X=8, Y=26, S="F", O="F"}
cbrxTSLs["CIVILIZATION_MC_CALUSA"] = {X=86, Y=38, S="T", O="F"}
cbrxTSLs["CIVILIZATION_MC_BUCCANEER"] = {X=86, Y=33, S="T", O="T"}
cbrxTSLs["CIVILIZATION_LUNGNORWAY"] = {X=10, Y=55, S="F", O="F"}
cbrxTSLs["CIVILIZATION_TECHNO_KALAALLIT"] = {X=97, Y=58, S="F", O="F"}
cbrxTSLs["CIVILIZATION_DMS_FAROE_ISLANDS"] = {X=5, Y=58, S="T", O="F"}
cbrxTSLs["CIVILIZATION_RTRYPILLIA"] = {X=21, Y=44, S="F", O="F"}
cbrxTSLs["CIVILIZATION_KHAZAR"] = {X=27, Y=44, S="F", O="F"}
cbrxTSLs["CIVILIZATION_TCM_ILKHANATE"] = {X=27, Y=36, S="F", O="F"}
cbrxTSLs["CIVILIZATION_UAE"] = {X=29, Y=28, S="F", O="F"}
cbrxTSLs["CIVILIZATION_JMANGELO_QATAR"] = {X=29, Y=28, S="F", O="F"}
cbrxTSLs["CIVILIZATION_JFD_NICHOLAS_RUSSIA"] = {X=21, Y=52, S="F", O="F"}
cbrxTSLs["CIVILIZATION_JWW_BORA_BORA"] = {X=73, Y=17, S="T", O="T"}
cbrxTSLs["CIVILIZATION_SM_KAKJAPAN"] = {X=60, Y=42, S="T", O="F"}
cbrxTSLs["CIVILIZATION_GT_YAGHAN"] = {X=87, Y=1, S="T", O="F"}
cbrxTSLs["CIVILIZATION_UC_TEUTONS"] = {X=16, Y=46, S="F", O="F"}
cbrxTSLs["CIVILIZATION_DJ_LIECHTENSTEIN"] = {X=12, Y=42, S="F", O="F"}
cbrxTSLs["CIVILIZATION_JFD_DENMARK_NORWAY"] = {X=12, Y=48, S="T", O="F"}
cbrxTSLs["CIVILIZATION_DENMARK"] = {X=12, Y=48, S="T", O="F"}
cbrxTSLs["CIVILIZATION_DMS_XI_XIA"] = {X=43, Y=43, S="F", O="F"}
cbrxTSLs["CIVILIZATION_DMS_WUYUE"] = {X=52, Y=38, S="T", O="F"}
cbrxTSLs["CIVILIZATION_CSLESOTHO"] = {X=20, Y=6, S="F", O="F"}
cbrxTSLs["CIVILIZATION_MC_SCOTLAND"] = {X=5, Y=52, S="T", O="F"}
cbrxTSLs["CIVILIZATION_EW_NEUTRAL"] = {X=86, Y=50, S="F", O="F"}
cbrxTSLs["CIVILIZATION_EW_PRIAMURYE"] = {X=55, Y=50, S="F", O="F"}
cbrxTSLs["CIVILIZATION_EW_BRITONS"] = {X=3, Y=44, S="T", O="F"}
cbrxTSLs["CIVILIZATION_CSSILURES"] = {X=3, Y=46, S="T", O="F"}
cbrxTSLs["CIVILIZATION_JFD_BRITTANY"] = {X=4, Y=41, S="T", O="F"}
cbrxTSLs["CIVILIZATION_JFD_NORMANDY"] = {X=6, Y=43, S="T", O="F"}
cbrxTSLs["CIVILIZATION_EW_COMMUNE"] = {X=8, Y=42, S="F", O="F"}
cbrxTSLs["CIVILIZATION_EW_PARG"] = {X=32, Y=49, S="F", O="F"}
cbrxTSLs["CIVILIZATION_PERM"] = {X=28, Y=51, S="F", O="F"}
cbrxTSLs["CIVILIZATION_CBR_POMO"] = {X=72, Y=47, S="F", O="F"}


local observerTechs = {1, 2, 4, 6, 10, 25}
local sailing = GameInfoTypes["TECH_SAILING"]
local optics = GameInfoTypes["TECH_OPTICS"]

function addSailing(iPlayer)
	if not (Game.GetGameTurn() < 3) then return end
	local pPlayer = Players[iPlayer]
	if not pPlayer then return end
	local sCivilizationType = GameInfo.Civilizations[pPlayer:GetCivilizationType()].Type
	if not sCivilizationType then return end
	local pTeam = Teams[pPlayer:GetTeam()]

	if cbrxTSLs[sCivilizationType] then
		for v in pPlayer:Units() do
			if v:GetUnitType() == 0 then
				v:SetXY(cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)
			end
		end
	end

	if cbrxTSLs[sCivilizationType].S == "T" then
		pTeam:SetHasTech(sailing, true)
		pTeam:SetHasTech(optics, true)
	end
end
GameEvents.PlayerDoTurn.Add(addSailing)

function setTSLs()
	if Game.GetGameTurn() < 3 then
		for iPlayer = 0, GameDefines.MAX_MAJOR_CIVS - 1, 1 do
			local pPlayer = Players[iPlayer]
			if not pPlayer then return end
			local sCivilizationType = GameInfo.Civilizations[pPlayer:GetCivilizationType()].Type
			local pTeam = Teams[pPlayer:GetTeam()]
			local currentTeamID = pTeam:GetID()

			if iPlayer == 0 then
				for index, val in ipairs(observerTechs) do
					pTeam:SetHasTech(val, true)
				end
			end

			for i = 0, Map.GetNumPlots()-1, 1 do
				local plot = Map.GetPlotByIndex(i);
				local oldVisibility = plot:GetVisibilityCount(currentTeamID)

				if oldVisibility > 0 then
					plot:ChangeVisibilityCount(currentTeamID, -1, -1, true, true)
					plot:SetRevealed(currentTeamID, false)
					plot:UpdateFog()
				end
			end
			Game.UpdateFOW(true);
			UI.RequestMinimapBroadcast();

			if cbrxTSLs[sCivilizationType] then
				print(sCivilizationType)
				for v in pPlayer:Units() do
					v:SetXY(cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)
				end

				pPlayer:InitUnit(1, cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)
				pPlayer:InitUnit(81, cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)

				if cbrxTSLs[sCivilizationType].O == "T" then

					local worker = false

					for u in pPlayer:Units() do
						if u:GetUnitType() == 83 then
							local newTrireme = pPlayer:InitUnit(22, u:GetX(), u:GetY())
							newTrireme:JumpToNearestValidPlot()
							u:Kill()
						elseif u:GetUnitType() == 1 and (cbrxTSLs[sCivilizationType].S == "T" or worker == false) then
							local newWorkBoat = pPlayer:InitUnit(2, u:GetX(), u:GetY())
							newWorkBoat:JumpToNearestValidPlot()
							u:Kill()
							worker = true
						end
					end
				end
			end
		end
	end
end
Events.SequenceGameInitComplete.Add(setTSLs)
