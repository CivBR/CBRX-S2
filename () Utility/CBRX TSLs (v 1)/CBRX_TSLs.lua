local cbrxTSLs = {}

cbrxTSLs["CIVILIZATION_BABYLON"] = {X=46, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_DJ_ICELAND"] = {X=0, Y=0, S="T", O="T"}
cbrxTSLs["CIVILIZATION_WALES"] = {X=0, Y=0, S="T", O="F"}
cbrxTSLs["CIVILIZATION_SWEDEN"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_TCM_BOURBON_SPAIN"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_MC_GAUL"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_GREATEREUROPE_GERMANY"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_JFD_TWO_SICILIES"] = {X=0, Y=0, S="T", O="F"}
cbrxTSLs["CIVILIZATION_SF_KOSOVO"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_UC_TEUTONS"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_FINNS"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_JFD_USSR_LENIN"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_PERM"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_MC_JERUSALEM"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_US_GEORGIA"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_TCM_PTOLEMIES"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_JFD_VANDALS_GENSERIC"] = {X=0, Y=0, S="T", O="F"}
cbrxTSLs["CIVILIZATION_MC_TUAREG"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_DMS_BURKINA_FASO"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_CL_NIGERIA"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_DMS_ZAIRE"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_THP_SOMALIA"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_SENSHI_ZANZIBAR"] = {X=0, Y=0, S="T", O="F"}
cbrxTSLs["CIVILIZATION_THP_NAMIBIA"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_CSLESOTHO"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_KURD"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_UC_HEJAZ"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_JWW_UZBEKISTAN"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_JFD_PUNJAB"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_BHUTAN"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_MC_CHOLA"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_EW_PARG"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_THP_NORTHYUAN"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_SENSHI_CHUKCHI"] = {X=0, Y=0, S="T", O="F"}
cbrxTSLs["CIVILIZATION_SENSHI_MANCHU"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_SM_KAKJAPAN"] = {X=0, Y=0, S="T", O="F"}
cbrxTSLs["CIVILIZATION_TAR_YUAN"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_PB_TAIPING"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_C15_NVIET"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_JFD_LAOS"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_ORG_MALACCA"] = {X=0, Y=0, S="T", O="F"}
cbrxTSLs["CIVILIZATION_VANA_VOC"] = {X=0, Y=0, S="T", O="F"}
cbrxTSLs["CIVILIZATION_THP_ANANGU"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_CL_KULIN"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_JFD_HAWAII"] = {X=0, Y=0, S="T", O="T"}
cbrxTSLs["CIVILIZATION_TAHITI_LS_MOD"] = {X=0, Y=0, S="T", O="T"}
cbrxTSLs["CIVILIZATION_DENEFIRSTNATION"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_MC_CHINOOK"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_SAS_TONGVA"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_MC_MHA"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_MISSISSIPPI_MOD_TOMATEKH"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_JWW_RIO_GRANDE"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_VANA_NEWNETHERLAND"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_EW_NEUTRAL"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_LEUGI_OLMEC"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_PI_JAMAICA"] = {X=0, Y=0, S="T", O="T"}
cbrxTSLs["CIVILIZATION_PG_GRANCOLOMBIA"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_SENSHI_MARAJO"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_PB_PALMARES"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_SENSHI_PERUBOLIVIA"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_UC_PARAGUAY"] = {X=0, Y=0, S="F", O="F"}
cbrxTSLs["CIVILIZATION_MAPUCHE"] = {X=0, Y=0, S="F", O="F"}



local observerTechs = {1, 2, 4, 6, 10, 25}
local sailing = GameInfoTypes["TECH_SAILING"]
local optics = GameInfoTypes["TECH_OPTICS"]

function addSailing(iPlayer)
	if not (Game.GetGameTurn() < 3) then return end
	local pPlayer = Players[iPlayer]
	if not pPlayer then return end
	local sCivilizationType = GameInfo.Civilizations[pPlayer:GetCivilizationType()].Type
	if not sCivilizationType then return end
	local pTeam = Teams[pPlayer:GetTeam()]

	if cbrxTSLs[sCivilizationType] then
		for v in pPlayer:Units() do
			if v:GetUnitType() == 0 then
				v:SetXY(cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)
			end
		end
	end

	if cbrxTSLs[sCivilizationType].S == "T" then
		pTeam:SetHasTech(sailing, true)
		pTeam:SetHasTech(optics, true)
	end
end
GameEvents.PlayerDoTurn.Add(addSailing)

function setTSLs()
	if Game.GetGameTurn() < 3 then
		for iPlayer = 0, GameDefines.MAX_MAJOR_CIVS - 1, 1 do
			local pPlayer = Players[iPlayer]
			if not pPlayer then return end
			local sCivilizationType = GameInfo.Civilizations[pPlayer:GetCivilizationType()].Type
			local pTeam = Teams[pPlayer:GetTeam()]
			local currentTeamID = pTeam:GetID()

			if iPlayer == 0 then
				for index, val in ipairs(observerTechs) do
					pTeam:SetHasTech(val, true)
				end
			end

			for i = 0, Map.GetNumPlots()-1, 1 do
				local plot = Map.GetPlotByIndex(i);
				local oldVisibility = plot:GetVisibilityCount(currentTeamID)

				if oldVisibility > 0 then
					plot:ChangeVisibilityCount(currentTeamID, -1, -1, true, true)
					plot:SetRevealed(currentTeamID, false)
					plot:UpdateFog()
				end
			end
			Game.UpdateFOW(true);
			UI.RequestMinimapBroadcast();

			if cbrxTSLs[sCivilizationType] then
				print(sCivilizationType)
				for v in pPlayer:Units() do
					v:SetXY(cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)
				end

				pPlayer:InitUnit(1, cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)
				pPlayer:InitUnit(81, cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)

				if cbrxTSLs[sCivilizationType].O == "T" then

					local worker = false

					for u in pPlayer:Units() do
						if u:GetUnitType() == 83 then
							local newTrireme = pPlayer:InitUnit(22, u:GetX(), u:GetY())
							newTrireme:JumpToNearestValidPlot()
							u:Kill()
						elseif u:GetUnitType() == 1 and (cbrxTSLs[sCivilizationType].S == "T" or worker == false) then
							local newWorkBoat = pPlayer:InitUnit(2, u:GetX(), u:GetY())
							newWorkBoat:JumpToNearestValidPlot()
							u:Kill()
							worker = true
						end
					end
				end
			end
		end
	end
end
Events.SequenceGameInitComplete.Add(setTSLs)
