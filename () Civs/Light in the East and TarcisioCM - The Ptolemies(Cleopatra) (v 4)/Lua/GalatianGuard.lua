--=================================================================================================================================================================================================================================================
--Programmed by TarcisioCM
--Handles all the mechanics that require Lua for the Galatian Guard.
--=================================================================================================================================================================================================================================================
include("PlotIterators")
--=================================================================================================================================================================================================================================================
--==~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~==
--=================================================================================================================================================================================================================================================
local formula_ExperienceToCultureRatio = 0.66
local unitName = GameInfoTypes["UNIT_LITE_TARCISIO_PTOLEMIES_GALATIAN_GUARD"]
local promotionName = GameInfoTypes["PROMOTION_LITE_TARCISIO_CITY_BONUS"]
--=================================================================================================================================================================================================================================================
--==~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~==
--=================================================================================================================================================================================================================================================
function GalatianGuardDisband(unitOwnerId, unitId, unitType, unitX, unitY, bDelay, eKillingPlayer)
	if bDelay then
		local player = Players[unitOwnerId]
		if eKillingPlayer == -1 then
			local unit = player:GetUnitByID(unitId)
			if unit:GetUnitType() == unitName then
				local experience = unit:GetExperience()
				if experience > 0 then
					experience = formula_ExperienceToCultureRatio / experience
					player:ChangeJONSCulture(experience)
				end
			end
		end
	end
end
GameEvents.UnitPrekill.Add(GalatianGuardDisband)

function GalatianGuardBonuses(playerID, unitID, unitX, unitY)
	local player = Players[playerID]
	local unit = player:GetUnitByID(unitID)
	local plot = unit:GetPlot()
	if unit:GetUnitType() == unitName and plot then
		unit:SetHasPromotion(promotionName, false)
		for loopPlot in PlotAreaSweepIterator(plot, 2, SECTOR_NORTH, DIRECTION_CLOCKWISE, DIRECTION_OUTWARDS, CENTRE_INCLUDE) do
			local city = loopPlot:GetPlotCity()
			if city and city:GetOwner() == playerID then
				unit:SetHasPromotion(promotionName, true)
				break
			end
		end
	end
end
GameEvents.UnitSetXY.Add(GalatianGuardBonuses)
--=================================================================================================================================================================================================================================================
--==~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~==
--=================================================================================================================================================================================================================================================